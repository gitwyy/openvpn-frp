# 变更日志

All notable changes to this project will be documented in this file.

本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范。

## [Unreleased]

### 计划新增
- [ ] Web管理界面
- [ ] 自动证书更新功能
- [ ] 多用户权限管理
- [ ] API接口支持
- [ ] Grafana监控面板
- [ ] 自动备份到云存储

### 计划改进
- [ ] 优化Docker镜像大小
- [ ] 支持IPv6网络
- [ ] 增强安全审计功能
- [ ] 改进移动设备支持

## [1.0.1] - 2024-05-29

### 🔧 重大修复

#### 健康检查脚本完全重构
- 🐛 **macOS兼容性修复** 完全解决健康检查脚本在macOS系统上的兼容性问题
  - 修复端口检测问题（macOS lsof命令参数适配）
  - 修复证书日期解析问题（GMT时间格式和date命令兼容）
  - 修复内存计算问题（使用vm_stat替代free命令）
  - 添加操作系统自动识别功能

#### 性能显著提升
- ⚡ **执行性能优化** 26项检查从3-5秒优化到小于1秒完成
- ⚡ **Apple Silicon优化** 在M1/M2芯片上实现极高性能
- ⚡ **兼容性保证** 确保Linux环境性能不受影响

#### 具体修复内容
- 🔧 **端口检测改进**
  - Linux: 继续使用 `lsof -i UDP:1194 -t`
  - macOS: 改用 `lsof -nP -i UDP:1194` 并智能解析输出
- 🔧 **证书解析增强**
  - Linux: 保持使用 `date -d` 命令
  - macOS: 使用 `date -j -f` 命令处理GMT时间格式
- 🔧 **内存监控适配**
  - Linux: 继续使用 `free -m` 命令
  - macOS: 使用 `vm_stat` 命令并实现复杂的内存计算逻辑
- 🔧 **系统检测智能化**
  - 添加自动操作系统类型检测
  - 根据系统类型选择合适的命令和参数

#### 验证和测试
- ✅ **macOS Sequoia**: 完全兼容，包括Apple Silicon (M1/M2)
- ✅ **Linux发行版**: 保持100%向后兼容
- ✅ **性能基准**: 所有平台执行时间<1秒
- ✅ **功能完整**: 26项检查全部正常工作

### 📚 文档更新
- 📝 **README.md** 更新健康检查部分的macOS兼容性说明
- 📝 **HEALTH-CHECK-UPDATE.md** 详细记录修复过程和验证结果
- 📝 **变更日志** 完整记录本次重大修复内容

### 🎯 影响范围
此次修复主要影响：
- **macOS用户**: 从完全无法使用变为完全兼容
- **Linux用户**: 性能提升，功能保持不变
- **所有用户**: 执行速度显著提升，用户体验改善

## [1.0.0] - 2024-05-27

### 🎉 首次发布

#### 新增功能
- ✨ **完整的一键部署系统**
  - 支持三种部署模式：Standalone、FRP-Client、FRP-Full
  - 自动依赖检查和环境验证
  - 智能配置生成和验证

- ✨ **全自动证书管理**
  - PKI证书体系自动生成
  - 支持自定义密钥长度和有效期
  - 证书验证和健康检查
  - 证书过期提醒功能

- ✨ **多平台客户端配置生成**
  - 支持Android、iOS、Windows、macOS、Linux
  - 内联和分离格式支持
  - 二维码生成功能
  - 自动检测最佳连接模式

- ✨ **完整的服务管理系统**
  - 服务生命周期管理（启动、停止、重启、状态查看）
  - 实时日志查看和分析
  - 配置备份和恢复
  - 客户端证书增删改查

- ✨ **全方位健康检查**
  - Docker服务状态监控
  - 网络连通性验证
  - 证书有效期检查
  - 系统资源监控
  - 多种输出格式（JSON、HTML、Prometheus）

- ✨ **FRP集成支持**
  - 内网穿透功能
  - FRP服务端和客户端自动配置
  - 管理后台界面
  - 安全Token管理

#### 核心组件

##### 部署脚本 (`scripts/deploy.sh`)
```bash
# 功能特性
- 系统依赖自动检查
- 环境配置验证
- 证书自动生成
- Docker镜像构建
- 服务启动和验证
- 部署后信息展示
- 调试和演练模式
- 错误处理和清理

# 部署模式
- Standalone：适用于有公网IP的服务器
- FRP-Client：适用于内网服务器穿透
- FRP-Full：完整FRP架构部署
```

##### 管理脚本 (`scripts/manage.sh`)
```bash
# 服务管理
- start/stop/restart/status 命令
- 特定服务控制
- 优雅关闭支持

# 日志管理
- 实时日志跟踪
- 历史日志查看
- 多服务日志聚合
- 日志过滤和搜索

# 备份恢复
- 完整系统备份
- 增量备份支持
- 自动恢复功能
- 备份验证

# 客户端管理
- 客户端证书CRUD操作
- 批量客户端管理
- 客户端状态监控
```

##### 健康检查 (`scripts/health-check.sh`)
```bash
# 检查项目
- Docker容器状态
- 网络连通性
- 证书有效性
- 系统资源使用
- 配置文件完整性

# 输出格式
- 文本格式（默认）
- JSON格式
- HTML报告
- Prometheus指标

# 监控集成
- Nagios兼容
- Zabbix支持
- 连续监控模式
- 告警阈值配置
```

##### 客户端配置生成 (`scripts/generate-client-config.sh`)
```bash
# 平台支持
- Android优化配置
- iOS兼容设置
- Windows企业配置
- macOS集成优化
- Linux服务器配置

# 连接模式
- 自动模式检测
- 直连模式
- FRP穿透模式

# 输出格式
- 内联格式（推荐移动设备）
- 分离格式（便于管理）
- 二维码生成
- 批量生成支持
```

#### 安全特性

- 🔐 **强化的证书管理**
  - RSA 2048/4096位密钥支持
  - 自定义证书有效期
  - TLS-Auth双重认证
  - 证书撤销列表(CRL)支持

- 🔐 **网络安全配置**
  - 默认安全的OpenVPN配置
  - 防火墙规则自动配置
  - DDoS防护建议
  - 安全审计日志

- 🔐 **FRP安全增强**
  - 强随机Token生成
  - TLS加密传输
  - 管理后台认证
  - 连接频率限制

#### 监控和运维

- 📊 **完整的监控体系**
  - 实时服务状态监控
  - 证书过期监控
  - 系统资源监控
  - 自定义告警规则

- 📊 **运维自动化**
  - 自动备份策略
  - 日志轮转管理
  - 系统清理任务
  - 更新检查机制

#### 文档系统

- 📚 **完整的中文文档**
  - 详细的部署指南
  - 全面的安全配置指南
  - 完整的脚本参考手册
  - 常见问题解答
  - 故障排除指南

- 📚 **示例和教程**
  - 多种部署场景示例
  - 最佳实践指南
  - 性能优化建议
  - 集成方案说明

#### 技术架构

##### Docker化部署
```yaml
# 核心组件
- OpenVPN容器：核心VPN服务
- FRP服务端容器：内网穿透服务端
- FRP客户端容器：内网穿透客户端

# 网络架构
- 隔离的Docker网络
- 智能端口映射
- 自动NAT配置
```

##### 配置管理
```bash
# 环境配置
- .env环境变量管理
- 配置模板系统
- 自动配置生成
- 配置验证机制

# 证书管理
- 自动PKI体系
- 证书生命周期管理
- 安全存储策略
```

##### 脚本系统
```bash
# 模块化设计
- 独立功能模块
- 统一错误处理
- 详细日志记录
- 参数验证机制

# 可扩展性
- 插件化架构
- 自定义钩子支持
- 配置驱动行为
```

### 🔧 技术规格

#### 系统要求
- **操作系统**：Linux、macOS、Windows (WSL)
- **Docker**：20.10+
- **Docker Compose**：1.29+
- **OpenSSL**：1.1+
- **网络工具**：netcat、curl

#### 支持的平台
- **服务器端**：Ubuntu 18.04+、CentOS 7+、Debian 10+、macOS 10.15+
- **客户端**：Android 6.0+、iOS 12.0+、Windows 10+、macOS 10.15+、Linux发行版

#### 性能指标
- **最大并发连接**：100+（可配置）
- **支持带宽**：千兆网络
- **证书有效期**：1-10年（可配置）
- **启动时间**：< 60秒
- **资源占用**：< 512MB内存

### 📁 项目结构

```
openvpn-frp/
├── 📁 config/                    # 配置文件目录
│   ├── server.conf               # OpenVPN服务器配置
│   ├── openssl.cnf              # SSL证书配置
│   ├── frps.ini                 # FRP服务端配置
│   └── frpc.ini                 # FRP客户端配置
├── 📁 docker/                    # Docker构建文件
│   ├── openvpn/                 # OpenVPN容器配置
│   │   ├── Dockerfile           # OpenVPN镜像构建
│   │   └── start-openvpn.sh     # 启动脚本
│   └── frp/                     # FRP容器配置
│       ├── frps/                # FRP服务端
│       └── frpc/                # FRP客户端
├── 📁 docs/                      # 文档目录
│   ├── DEPLOYMENT-GUIDE.md      # 详细部署指南
│   ├── SECURITY-GUIDE.md        # 安全配置指南
│   ├── SCRIPTS-REFERENCE.md     # 脚本参考手册
│   ├── FAQ.md                   # 常见问题解答
│   └── FRP-DEPLOYMENT.md        # FRP专用文档
├── 📁 pki/                       # 证书目录（运行时生成）
│   ├── ca/                      # CA证书
│   ├── server/                  # 服务器证书
│   ├── clients/                 # 客户端证书
│   └── dh/                      # DH参数
├── 📁 scripts/                   # 脚本目录
│   ├── 🚀 deploy.sh             # 一键部署脚本
│   ├── ⚙️ manage.sh              # 服务管理脚本
│   ├── 🏥 health-check.sh       # 健康检查脚本
│   ├── 📱 generate-client-config.sh # 客户端配置生成
│   ├── 🔐 generate-certs.sh     # 证书生成脚本
│   ├── ✅ verify-certs.sh       # 证书验证脚本
│   ├── 🐳 build-openvpn.sh      # OpenVPN构建脚本
│   └── 🐳 build-frp.sh          # FRP构建脚本
├── .env.example                  # 环境配置模板
├── .dockerignore                 # Docker忽略文件
├── docker-compose.yml           # 主要编排文件
├── docker-compose.frp.yml       # FRP专用编排文件
├── CHANGELOG.md                 # 变更日志（本文件）
├── LICENSE                      # 开源许可证
├── CONTRIBUTING.md              # 贡献指南
└── README.md                    # 项目说明
```

### 🌟 主要优势

1. **一键部署**：完全自动化的部署流程，无需手动配置
2. **多场景支持**：灵活适应不同网络环境和需求
3. **企业级安全**：完整的PKI体系和安全配置
4. **全平台支持**：支持所有主流操作系统和设备
5. **智能管理**：全方位的监控和管理功能
6. **易于维护**：完善的备份恢复和更新机制
7. **详细文档**：全面的中文文档和示例
8. **社区友好**：开源项目，欢迎贡献和反馈

### 🎯 适用场景

#### 个人用户
- 家庭网络远程访问
- 个人隐私保护
- 绕过地理限制
- 安全的公共WiFi使用

#### 企业用户
- 远程办公VPN解决方案
- 分支机构网络连接
- 安全的数据传输通道
- 内网资源远程访问

#### 开发者
- 开发环境远程访问
- 测试网络环境搭建
- CI/CD流水线集成
- 多地协作开发

#### 系统管理员
- 服务器远程管理
- 网络故障排除
- 安全审计和监控
- 自动化运维集成

### 📝 升级说明

由于这是首次发布版本，暂无升级指导。

未来版本的升级将遵循以下原则：
- 向后兼容现有配置
- 提供自动迁移脚本
- 详细的升级指导文档
- 安全的回滚机制

### 🙏 致谢

感谢以下开源项目的贡献：
- [OpenVPN](https://openvpn.net/) - 核心VPN协议实现
- [FRP](https://github.com/fatedier/frp) - 内网穿透解决方案
- [Docker](https://www.docker.com/) - 容器化平台
- 所有测试用户和贡献者的反馈和建议

### 📄 许可证

本项目基于 [MIT许可证](LICENSE) 开源。

---

## 版本命名规范

本项目采用语义化版本号：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 版本类型说明

- **Alpha**：内部测试版本，功能不完整
- **Beta**：公开测试版本，功能基本完整
- **RC (Release Candidate)**：发布候选版本
- **Stable**：稳定发布版本

## 贡献指南

### 如何贡献到变更日志

1. **功能开发**：在对应版本的"新增"部分添加条目
2. **Bug修复**：在对应版本的"修复"部分添加条目
3. **改进优化**：在对应版本的"改进"部分添加条目
4. **重大变更**：在对应版本的"重大变更"部分添加条目

### 变更日志格式

每个变更条目应包含：
- 📝 **变更类型**：新增/修复/改进/删除
- 📝 **影响范围**：核心/脚本/文档/配置
- 📝 **简要描述**：清晰描述变更内容
- 📝 **相关Issue**：如有相关Issue，请引用

示例：
```markdown
#### 新增
- ✨ **脚本增强** 新增自动证书更新功能 (#123)
- ✨ **监控改进** 添加Grafana面板模板 (#124)

#### 修复
- 🐛 **连接问题** 修复Android客户端连接超时问题 (#125)
- 🐛 **部署脚本** 修复macOS环境下的权限问题 (#126)

#### 改进
- 🔧 **性能优化** 优化Docker镜像大小，减少50%存储空间 (#127)
- 🔧 **文档更新** 完善故障排除指南 (#128)
```

## 维护指南

### 版本发布流程

1. **代码冻结**：停止新功能开发
2. **测试验证**：全面测试新版本功能
3. **文档更新**：更新相关文档和示例
4. **变更日志**：完善变更日志条目
5. **版本标记**：创建Git标签
6. **发布公告**：发布版本公告

### 支持策略

- **最新版本**：提供完整技术支持
- **前一版本**：提供安全更新和重要修复
- **更早版本**：仅提供安全更新

---

**保持更新，关注项目发展！** 🚀